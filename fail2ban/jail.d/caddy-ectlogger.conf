# Fail2Ban jail for Caddy serving ECTLogger
#
# This jail monitors Caddy access logs for malicious requests
# such as vulnerability scanners, exploit attempts, and bots.
#
# Prerequisites:
# 1. Copy fail2ban/filter.d/caddy-ectlogger.conf to /etc/fail2ban/filter.d/
# 2. Configure Caddy to log to a file (see Caddyfile snippet below)
# 3. Restart fail2ban: sudo systemctl restart fail2ban

[caddy-ectlogger]
enabled = true
port = http,https
filter = caddy-ectlogger
logpath = /var/log/caddy/access.log
maxretry = 3
findtime = 600
bantime = 86400
action = %(action_mwl)s

# More aggressive jail for repeat offenders
[caddy-ectlogger-aggressive]
enabled = true
port = http,https
filter = caddy-ectlogger
logpath = /var/log/caddy/access.log
maxretry = 10
findtime = 86400
bantime = 604800
action = %(action_mwl)s

# Notes:
# - caddy-ectlogger: Bans for 24 hours after 3 suspicious requests in 10 minutes
# - caddy-ectlogger-aggressive: Bans for 1 week after 10 suspicious requests in 24 hours
#
# Caddyfile logging configuration (add inside your site block):
#
#   ectlogger.example.com {
#       log {
#           output file /var/log/caddy/access.log {
#               roll_size 100mb
#               roll_keep 5
#           }
#           format json
#       }
#       # ... rest of your config
#   }
